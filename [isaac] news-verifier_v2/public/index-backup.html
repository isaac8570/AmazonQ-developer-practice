<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactCheck AI - ë‰´ìŠ¤ ê²€ì¦ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ffff, #ff006e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #00ffff, #0099cc);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #00ffff;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .score-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            font-weight: 700;
        }

        .score-high { background: linear-gradient(45deg, #00ff88, #00cc66); }
        .score-medium { background: linear-gradient(45deg, #ffaa00, #ff8800); }
        .score-low { background: linear-gradient(45deg, #ff006e, #cc0055); }

        .source-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #00ffff;
        }

        .source-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .source-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin: 8px 0;
            line-height: 1.4;
        }

        .source-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            opacity: 0.8;
            flex-wrap: wrap;
        }

        .source-link {
            color: #00ffff;
            text-decoration: none;
        }

        .credibility-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .credibility-high { background: #00ff88; color: #000; }
        .credibility-medium { background: #ffaa00; color: #000; }
        .title-match-score {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .matched-keywords {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            margin: 2px;
            display: inline-block;
        }
        
        .filter-stats {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .filter-stats h4 {
            color: #00ffff;
            margin-bottom: 10px;
        }

        .error-section {
            text-align: center;
            padding: 40px;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .error-details {
            opacity: 0.8;
            margin-bottom: 20px;
        }

        /* ì‹œê°í™” ìŠ¤íƒ€ì¼ */
        .visualization-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .viz-container {
            margin-bottom: 30px;
        }

        .viz-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #00ffff;
            text-align: center;
        }

        .mindmap-svg, .timeline-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mindmap-svg {
            height: 500px;
        }

        .timeline-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .timeline-container::-webkit-scrollbar {
            width: 8px;
        }

        .timeline-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .timeline-container::-webkit-scrollbar-thumb {
            background: #ff006e;
            border-radius: 4px;
        }

        .node-center {
            fill: #ff006e;
            stroke: #fff;
            stroke-width: 4px;
            filter: drop-shadow(0 0 10px rgba(255, 0, 110, 0.5));
        }

        .node-news {
            fill: #00ffff;
            stroke: #fff;
            stroke-width: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 5px rgba(0, 255, 255, 0.3));
        }

        .node-news:hover {
            filter: drop-shadow(0 0 15px rgba(255, 140, 0, 0.8));
        }

        .link {
            stroke: rgba(255, 255, 255, 0.6);
            stroke-width: 2px;
            opacity: 0.7;
        }

        .node-text {
            fill: white;
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .node-text-center {
            fill: white;
            font-size: 16px;
            font-weight: 700;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        /* ë§ˆì¸ë“œë§µ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .mindmap-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .viz-container {
            position: relative;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .axis text {
            fill: white;
            font-size: 12px;
        }

        .axis path,
        .axis line {
            stroke: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                FactCheck AI
            </div>
            <div class="subtitle">AI ê¸°ë°˜ ë‰´ìŠ¤ ì‹ ë¢°ë„ ê²€ì¦ ì‹œìŠ¤í…œ</div>
        </div>

        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ê²€ì¦í•˜ê³  ì‹¶ì€ ë‰´ìŠ¤ë‚˜ ì‚¬ê±´ì„ ì…ë ¥í•˜ì„¸ìš”..." id="searchInput">
                <button class="search-btn" onclick="verifyNews()" id="searchBtn">
                    <i class="fas fa-search"></i>
                    ê²€ì¦í•˜ê¸°
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>ë‰´ìŠ¤ë¥¼ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
        </div>

        <div class="results" id="results">
            <div class="score-section">
                <div class="score-circle" id="scoreCircle">
                    <span id="scoreValue">0</span>%
                </div>
                <div id="scoreDescription">ê²€ì¦ ê²°ê³¼</div>
            </div>

            <div id="sourcesList">
                <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <div id="analysisContent">
                <!-- ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <!-- ì‹œê°í™” ì„¹ì…˜ ì¶”ê°€ -->
            <div class="visualization-section" id="visualizationSection" style="display: none;">
                <div class="viz-container">
                    <div class="viz-title">ğŸ—ï¸ ë‰´ìŠ¤ ê´€ê³„ë„ (ë§ˆì¸ë“œë§µ)</div>
                    <div class="mindmap-controls">
                        <button class="control-btn" onclick="fitAllNodes()">ğŸ“ ì „ì²´ë³´ê¸°</button>
                        <button class="control-btn" onclick="resetMindMap()">ğŸ”„ ë¦¬ì…‹</button>
                        <button class="control-btn" onclick="centerMindMap()">ğŸ¯ ì¤‘ì‹¬</button>
                    </div>
                    <svg class="mindmap-svg" id="mindmapSvg"></svg>
                    <div style="text-align: center; margin-top: 15px; font-size: 12px; opacity: 0.8; line-height: 1.4;">
                        ğŸ’¡ <strong>ìŠ¤ë§ˆíŠ¸ ë‰´ìŠ¤ ë§ˆì¸ë“œë§µ:</strong> ë…¸ë“œ ë“œë˜ê·¸ë¡œ ì´ë™ | ë§ˆìš°ìŠ¤ íœ ë¡œ í™•ëŒ€/ì¶•ì†Œ<br>
                        ğŸ”´ ë©”ì¸ í‚¤ì›Œë“œ (ì¤‘ì‹¬) â†’ ğŸŸ£ í‚¤ì›Œë“œ ê·¸ë£¹ (ë¸Œëœì¹˜) â†’ ğŸŸ¢ğŸŸ¡ğŸ”´ ë‰´ìŠ¤ (ë§ë‹¨)<br>
                        <strong>ê·¸ë£¹ ë¶„ë¥˜:</strong> ğŸ”‘í‚¤ì›Œë“œ ğŸŒë„ë©”ì¸ â°ì‹œê°„ëŒ€ ğŸ›¡ï¸ì‹ ë¢°ë„ë³„ ìë™ ë¶„ë¥˜<br>
                        âš¡ ìµœì‹  ë‰´ìŠ¤ëŠ” ë…¸ë€ í…Œë‘ë¦¬ | ìˆ«ìëŠ” ë§¤ì¹­ ì ìˆ˜ | í´ë¦­í•˜ë©´ ì›ë¬¸ ê¸°ì‚¬ë¡œ ì´ë™
                    </div>
                </div>
                
                <div class="viz-container">
                    <div class="viz-title">ğŸ“ˆ ì‹œê°„ëŒ€ë³„ ë‰´ìŠ¤ ë°œí–‰ íŠ¸ë Œë“œ</div>
                    <div class="timeline-container" id="timeline"></div>
                </div>
            </div>
        </div>

        <!-- íˆ´íŒ -->
        <div class="tooltip" id="tooltip" style="display: none;"></div>
    </div>

    <script>
        console.log('ğŸš€ FactCheck AI ë¡œë“œë¨');

        async function verifyNews() {
            console.log('ğŸ” verifyNews í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            console.log('ğŸ“ ì…ë ¥ëœ ì¿¼ë¦¬:', query);
            
            if (!query) {
                alert('ê²€ì¦í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('searchBtn').disabled = true;
            
            try {
                console.log('ğŸ“¡ ì„œë²„ì— ìš”ì²­ ì „ì†¡ ì¤‘...');
                
                const response = await fetch('/api/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });
                
                console.log('ğŸ“¡ ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const data = await response.json();
                console.log('ğŸ“¦ ë°›ì€ ë°ì´í„°:', data);
                
                if (!response.ok) {
                    console.error('âŒ ì„œë²„ ì—ëŸ¬:', data);
                    displayError(data);
                    return;
                }
                
                displayResults(data);
                
            } catch (error) {
                console.error('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                displayError({
                    error: 'Network Error',
                    message: 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                    details: 'ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.'
                });
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('searchBtn').disabled = false;
            }
        }

        function displayResults(data) {
            console.log('ğŸ“Š ê²°ê³¼ í‘œì‹œ ì¤‘:', data);
            
            // ì‹ ë¢°ë„ ì ìˆ˜ í‘œì‹œ
            const scoreValue = document.getElementById('scoreValue');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreDescription = document.getElementById('scoreDescription');
            
            scoreValue.textContent = data.credibilityScore || 0;
            
            if (data.credibilityScore >= 70) {
                scoreCircle.className = 'score-circle score-high';
                scoreDescription.textContent = 'ë†’ì€ ì‹ ë¢°ë„ - ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ì…ë‹ˆë‹¤';
            } else if (data.credibilityScore >= 40) {
                scoreCircle.className = 'score-circle score-medium';
                scoreDescription.textContent = 'ë³´í†µ ì‹ ë¢°ë„ - ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤';
            } else {
                scoreCircle.className = 'score-circle score-low';
                scoreDescription.textContent = 'ë‚®ì€ ì‹ ë¢°ë„ - ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤';
            }
            
            // ì¶œì²˜ ëª©ë¡ í‘œì‹œ
            const sourcesList = document.getElementById('sourcesList');
            sourcesList.innerHTML = '';
            
            if (!data.sources || data.sources.length === 0) {
                sourcesList.innerHTML = '<div style="text-align: center; padding: 20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                console.log('âš ï¸ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ');
            } else {
                console.log(`ğŸ“° ${data.sources.length}ê°œ ë‰´ìŠ¤ í‘œì‹œ ì¤‘...`);
                
                data.sources.forEach((source, index) => {
                    const sourceCard = document.createElement('div');
                    sourceCard.className = 'source-card';
                    
                    const credibilityClass = source.credibility && source.credibility.toLowerCase() === 'high' ? 'credibility-high' : 
                                           source.credibility && source.credibility.toLowerCase() === 'medium' ? 'credibility-medium' : 'credibility-low';
                    
                    // ì œëª© ë§¤ì¹­ ì ìˆ˜ í‘œì‹œ
                    const titleMatchScore = source.titleMatchScore ? 
                        `<span class="title-match-score">ì œëª©ë§¤ì¹­: ${source.titleMatchScore}</span>` : '';
                    
                    // ë§¤ì¹­ëœ í‚¤ì›Œë“œ í‘œì‹œ
                    const matchedKeywords = source.matchedKeywords && source.matchedKeywords.length > 0 ? 
                        `<div style="margin-top: 8px;">
                            <strong>ë§¤ì¹­ í‚¤ì›Œë“œ:</strong> 
                            ${source.matchedKeywords.map(keyword => `<span class="matched-keywords">${keyword}</span>`).join('')}
                        </div>` : '';
                    
                    sourceCard.innerHTML = `
                        <div class="source-title">${source.title || 'No title'}</div>
                        <div class="source-description">${source.description || ''}</div>
                        ${matchedKeywords}
                        <div class="source-meta">
                            <a href="${source.url}" target="_blank" class="source-link">
                                <i class="fas fa-external-link-alt"></i> ${source.domain || 'unknown'}
                            </a>
                            <span><i class="fas fa-calendar"></i> ${source.publishedDate || 'Unknown date'}</span>
                            <span class="credibility-badge ${credibilityClass}">${source.credibility || 'Unknown'}</span>
                            ${titleMatchScore}
                        </div>
                    `;
                    sourcesList.appendChild(sourceCard);
                });
            }
            
            // ì œëª© í•„í„°ë§ í†µê³„ í‘œì‹œ
            if (data.titleFilterStats) {
                const filterInfo = document.createElement('div');
                filterInfo.className = 'filter-stats';
                filterInfo.innerHTML = `
                    <h4>ğŸ¯ ì œëª© ê¸°ë°˜ í•„í„°ë§ ê²°ê³¼</h4>
                    <p><strong>ì›ë³¸ ê²€ìƒ‰ ê²°ê³¼:</strong> ${data.titleFilterStats.originalCount}ê°œ</p>
                    <p><strong>ì œëª© ë§¤ì¹­ ê²°ê³¼:</strong> ${data.titleFilterStats.filteredCount}ê°œ</p>
                    <p><strong>í•„í„°ë§ ë¹„ìœ¨:</strong> ${data.titleFilterStats.filterRate}% ì œì™¸</p>
                    <p><strong>í•µì‹¬ í‚¤ì›Œë“œ:</strong> ${data.titleFilterStats.keywords.essential?.join(', ') || 'ì—†ìŒ'}</p>
                    <p style="font-size: 12px; opacity: 0.8; margin-top: 8px;">${data.titleFilterStats.message}</p>
                `;
                
                // ê²°ê³¼ ìƒë‹¨ì— ì¶”ê°€
                const resultsDiv = document.getElementById('results');
                const existingFilter = resultsDiv.querySelector('.filter-stats');
                if (existingFilter) {
                    existingFilter.remove();
                }
                resultsDiv.insertBefore(filterInfo, resultsDiv.firstChild);
            }
            if (data.analysis) {
                analysisContent.innerHTML = `
                    <div style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <h3>ìƒì„¸ ë¶„ì„</h3>
                        <p><strong>ê²€ì¦ ìƒíƒœ:</strong> ${data.analysis.verificationStatus || 'Unknown'}</p>
                        <p><strong>ì¢…í•© ì˜ê²¬:</strong> ${data.analysis.consensus || 'No consensus'}</p>
                        <p><strong>ìƒì¶© ì •ë³´:</strong> ${data.analysis.conflictingInfo ? 'ë°œê²¬ë¨' : 'ì—†ìŒ'}</p>
                    </div>
                `;
            }
            
            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('results').style.display = 'block';
            
            // ì‹œê°í™” ìƒì„±
            if (data.sources && data.sources.length > 0) {
                createVisualization(data.query, data.sources);
                document.getElementById('visualizationSection').style.display = 'block';
            }
            
            console.log('âœ… ê²°ê³¼ í‘œì‹œ ì™„ë£Œ');
        }

        function displayError(errorData) {
            console.log('âŒ ì—ëŸ¬ í‘œì‹œ:', errorData);
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="error-section">
                    <div class="error-icon">âš ï¸</div>
                    <div class="error-title">${errorData.message || 'ê²€ìƒ‰ ì‹¤íŒ¨'}</div>
                    <div class="error-details">${errorData.details || errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</div>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        // Enter í‚¤ë¡œ ê²€ìƒ‰
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                console.log('âŒ¨ï¸ Enter í‚¤ ëˆŒë¦¼');
                verifyNews();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ');
        });

        // ë‰´ìŠ¤ ê°„ ê´€ê³„ ë¶„ì„ í•¨ìˆ˜
        function analyzeNewsRelationships(newsData) {
            const relationships = [];
            
            for (let i = 0; i < newsData.length; i++) {
                for (let j = i + 1; j < newsData.length; j++) {
                    const news1 = newsData[i];
                    const news2 = newsData[j];
                    
                    let connectionStrength = 0;
                    let connectionType = '';
                    
                    // 1. ê°™ì€ ë„ë©”ì¸ (ê°™ì€ ì–¸ë¡ ì‚¬)
                    if (news1.domain === news2.domain) {
                        connectionStrength += 3;
                        connectionType = 'same-source';
                    }
                    
                    // 2. ê°™ì€ ë‚ ì§œ ë°œí–‰
                    if (news1.publishedDate === news2.publishedDate) {
                        connectionStrength += 2;
                        connectionType = connectionType || 'same-date';
                    }
                    
                    // 3. ì œëª© ìœ ì‚¬ë„ (ê³µí†µ ë‹¨ì–´)
                    const title1Words = news1.title.toLowerCase().split(/\s+/);
                    const title2Words = news2.title.toLowerCase().split(/\s+/);
                    const commonWords = title1Words.filter(word => 
                        title2Words.includes(word) && word.length > 2
                    );
                    
                    if (commonWords.length >= 2) {
                        connectionStrength += commonWords.length;
                        connectionType = connectionType || 'similar-content';
                    }
                    
                    // 4. ì‹ ë¢°ë„ ìœ ì‚¬ì„±
                    if (news1.credibility === news2.credibility) {
                        connectionStrength += 1;
                    }
                    
                    // ì—°ê²° ê°•ë„ê°€ ì¶©ë¶„í•˜ë©´ ê´€ê³„ ì¶”ê°€
                    if (connectionStrength >= 2) {
                        relationships.push({
                            source: `news-${i}`,
                            target: `news-${j}`,
                            strength: connectionStrength,
                            type: connectionType,
                            commonWords: commonWords || []
                        });
                    }
                }
            }
            
            return relationships;
        }

        // í‚¤ì›Œë“œ ì¤‘ì‹¬ íŠ¸ë¦¬ êµ¬ì¡° ìƒì„±
        function buildKeywordTree(centerKeyword, newsData) {
            const credibilityColors = {
                'High': '#00ff88',
                'Medium': '#ffaa00', 
                'Low': '#ff4444'
            };

            // ë‰´ìŠ¤ ë°ì´í„° ì „ì²˜ë¦¬
            const processedNews = newsData.map((news, index) => {
                const publishTime = new Date(news.publishedDate);
                const now = new Date();
                const hoursAgo = Math.floor((now - publishTime) / (1000 * 60 * 60));
                const timeText = hoursAgo < 24 ? `${hoursAgo}ì‹œê°„ ì „` : `${Math.floor(hoursAgo / 24)}ì¼ ì „`;

                return {
                    name: news.title.length > 30 ? news.title.substring(0, 30) + '...' : news.title,
                    fullTitle: news.title,
                    type: 'news',
                    url: news.url,
                    publishedDate: news.publishedDate,
                    timeText: timeText,
                    credibility: news.credibility,
                    credibilityColor: credibilityColors[news.credibility] || '#00ffff',
                    domain: news.domain,
                    matchCount: news.matchCount || 0,
                    description: news.description || '',
                    isRecent: hoursAgo < 6,
                    index: index
                };
            });

            // í‚¤ì›Œë“œ ì¶”ì¶œ ë° ê·¸ë£¹í™”
            const keywordGroups = extractKeywordGroups(processedNews, centerKeyword);
            
            // íŠ¸ë¦¬ êµ¬ì¡° ìƒì„±
            const tree = {
                name: centerKeyword,
                type: 'root',
                children: []
            };

            // ê·¸ë£¹ì— í¬í•¨ëœ ë‰´ìŠ¤ ì¸ë±ìŠ¤ ì¶”ì 
            const groupedNewsIndices = new Set();

            // í‚¤ì›Œë“œ ê·¸ë£¹ë³„ë¡œ ë¸Œëœì¹˜ ìƒì„±
            keywordGroups.forEach(group => {
                if (group.news.length > 0) {
                    const keywordBranch = {
                        name: group.keyword,
                        type: 'keyword',
                        newsCount: group.news.length,
                        relevanceScore: group.relevanceScore || group.count,
                        groupType: group.type || 'keyword-group',
                        children: group.news
                    };
                    tree.children.push(keywordBranch);
                    
                    // ê·¸ë£¹ì— í¬í•¨ëœ ë‰´ìŠ¤ ì¸ë±ìŠ¤ ê¸°ë¡
                    group.news.forEach(news => {
                        groupedNewsIndices.add(news.index);
                    });
                }
            });

            // í‚¤ì›Œë“œ ê·¸ë£¹ì— ì†í•˜ì§€ ì•ŠëŠ” ë‰´ìŠ¤ë“¤ ì²˜ë¦¬
            const ungroupedNews = processedNews.filter(news => 
                !groupedNewsIndices.has(news.index)
            );

            // ë¯¸ë¶„ë¥˜ ë‰´ìŠ¤ê°€ ìˆìœ¼ë©´ ì¶”ê°€ ë¶„ë¥˜ ì‹œë„
            if (ungroupedNews.length > 0) {
                // 1. ì‹ ë¢°ë„ë³„ ê·¸ë£¹í•‘
                const credibilityGroups = new Map();
                ungroupedNews.forEach(news => {
                    const cred = news.credibility || 'Medium';
                    if (!credibilityGroups.has(cred)) {
                        credibilityGroups.set(cred, []);
                    }
                    credibilityGroups.get(cred).push(news);
                });

                // ì‹ ë¢°ë„ë³„ë¡œ 2ê°œ ì´ìƒ ë‰´ìŠ¤ê°€ ìˆìœ¼ë©´ ê·¸ë£¹ ìƒì„±
                credibilityGroups.forEach((newsArray, credibility) => {
                    if (newsArray.length >= 2) {
                        const credibilityNames = {
                            'High': 'ì‹ ë¢°ë„ ë†’ì€ ë‰´ìŠ¤',
                            'Medium': 'ì¼ë°˜ ë‰´ìŠ¤',
                            'Low': 'ê²€ì¦ í•„ìš” ë‰´ìŠ¤'
                        };
                        
                        tree.children.push({
                            name: credibilityNames[credibility] || 'ê¸°íƒ€ ë‰´ìŠ¤',
                            type: 'keyword',
                            newsCount: newsArray.length,
                            groupType: 'credibility-group',
                            children: newsArray
                        });
                        
                        // ë¶„ë¥˜ëœ ë‰´ìŠ¤ ì œê±°
                        newsArray.forEach(news => {
                            const index = ungroupedNews.findIndex(n => n.index === news.index);
                            if (index !== -1) ungroupedNews.splice(index, 1);
                        });
                    }
                });

                // 2. ì‹œê°„ëŒ€ë³„ ê·¸ë£¹í•‘ (ë‚¨ì€ ë‰´ìŠ¤ ì¤‘)
                if (ungroupedNews.length > 0) {
                    const timeGroups = {
                        recent: ungroupedNews.filter(news => news.isRecent),
                        older: ungroupedNews.filter(news => !news.isRecent)
                    };

                    if (timeGroups.recent.length >= 2) {
                        tree.children.push({
                            name: 'ìµœì‹  ì†ë³´',
                            type: 'keyword',
                            newsCount: timeGroups.recent.length,
                            groupType: 'time-group',
                            children: timeGroups.recent
                        });
                        
                        // ë¶„ë¥˜ëœ ë‰´ìŠ¤ ì œê±°
                        timeGroups.recent.forEach(news => {
                            const index = ungroupedNews.findIndex(n => n.index === news.index);
                            if (index !== -1) ungroupedNews.splice(index, 1);
                        });
                    }

                    if (timeGroups.older.length >= 2) {
                        tree.children.push({
                            name: 'ì´ì „ ê´€ë ¨ ë‰´ìŠ¤',
                            type: 'keyword',
                            newsCount: timeGroups.older.length,
                            groupType: 'time-group',
                            children: timeGroups.older
                        });
                        
                        // ë¶„ë¥˜ëœ ë‰´ìŠ¤ ì œê±°
                        timeGroups.older.forEach(news => {
                            const index = ungroupedNews.findIndex(n => n.index === news.index);
                            if (index !== -1) ungroupedNews.splice(index, 1);
                        });
                    }
                }

                // 3. ì—¬ì „íˆ ë‚¨ì€ ë‰´ìŠ¤ë“¤ì€ "ê¸°íƒ€" ê·¸ë£¹ìœ¼ë¡œ
                if (ungroupedNews.length > 0) {
                    tree.children.push({
                        name: 'ê¸°íƒ€ ê´€ë ¨ ë‰´ìŠ¤',
                        type: 'keyword',
                        newsCount: ungroupedNews.length,
                        groupType: 'misc-group',
                        children: ungroupedNews
                    });
                }
            }

            // ë¹ˆ ê·¸ë£¹ ì œê±° ë° ì •ë ¬
            tree.children = tree.children
                .filter(child => child.children && child.children.length > 0)
                .sort((a, b) => {
                    // ê´€ë ¨ì„± ì ìˆ˜ê°€ ë†’ì€ ìˆœ, ë‰´ìŠ¤ ê°œìˆ˜ê°€ ë§ì€ ìˆœìœ¼ë¡œ ì •ë ¬
                    const scoreA = (a.relevanceScore || 0) + (a.newsCount * 0.5);
                    const scoreB = (b.relevanceScore || 0) + (b.newsCount * 0.5);
                    return scoreB - scoreA;
                });

            return tree;
        }

        // ê°œì„ ëœ í‚¤ì›Œë“œ ê·¸ë£¹ ì¶”ì¶œ
        function extractKeywordGroups(newsData, centerKeyword) {
            const keywordFreq = new Map();
            const stopWords = new Set(['ë‰´ìŠ¤', 'ê¸°ì‚¬', 'ë³´ë„', 'ë°œí‘œ', 'ê³µê°œ', 'í™•ì¸', 'ê´€ë ¨', 'ëŒ€í•œ', 'ìœ„í•œ', 'í†µí•´', 'ë”°ë¥¸', 'ì´ë²ˆ', 'ì˜¤ëŠ˜', 'ì–´ì œ', 'ë‚´ì¼', 'ìµœê·¼', 'í˜„ì¬', 'ì§€ë‚œ', 'ë‹¤ìŒ', 'ê·¸ë™ì•ˆ', 'ì•ìœ¼ë¡œ']);
            
            // ê° ë‰´ìŠ¤ì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ (ì œëª© + ì„¤ëª…)
            newsData.forEach((news, index) => {
                const textToAnalyze = `${news.fullTitle} ${news.description || ''}`.toLowerCase();
                
                // í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì¶”ì¶œí•˜ê³  ì˜ë¯¸ìˆëŠ” ë‹¨ì–´ í•„í„°ë§
                const words = textToAnalyze
                    .replace(/[^\w\sê°€-í£]/g, ' ')
                    .split(/\s+/)
                    .filter(word => {
                        // ê¸¸ì´ ì¡°ê±´: í•œê¸€ 2ê¸€ì ì´ìƒ, ì˜ë¬¸ 3ê¸€ì ì´ìƒ
                        const isValidLength = /[ê°€-í£]/.test(word) ? word.length >= 2 : word.length >= 3;
                        const isNotStopWord = !stopWords.has(word);
                        const isNotCenterKeyword = word !== centerKeyword.toLowerCase();
                        const isNotNumber = !/^\d+$/.test(word);
                        
                        return isValidLength && isNotStopWord && isNotCenterKeyword && isNotNumber;
                    });
                
                // í‚¤ì›Œë“œ ë¹ˆë„ ê³„ì‚° ë° ë‰´ìŠ¤ ì¸ë±ìŠ¤ ì €ì¥
                words.forEach(word => {
                    if (!keywordFreq.has(word)) {
                        keywordFreq.set(word, { 
                            count: 0, 
                            newsIndices: new Set(),
                            relevanceScore: 0
                        });
                    }
                    const keywordData = keywordFreq.get(word);
                    keywordData.count++;
                    keywordData.newsIndices.add(index);
                    
                    // ì œëª©ì— ìˆìœ¼ë©´ ê°€ì¤‘ì¹˜ ì¶”ê°€
                    if (news.fullTitle.toLowerCase().includes(word)) {
                        keywordData.relevanceScore += 2;
                    } else {
                        keywordData.relevanceScore += 1;
                    }
                });
            });

            // í‚¤ì›Œë“œ ê·¸ë£¹ ìƒì„± - ë” ìœ ì—°í•œ ì¡°ê±´
            const groups = [];
            const usedNewsIndices = new Set();
            
            Array.from(keywordFreq.entries())
                .filter(([word, data]) => {
                    // ìµœì†Œ 2ê°œ ë‰´ìŠ¤ì—ì„œ ì–¸ê¸‰ë˜ê±°ë‚˜, ë†’ì€ ê´€ë ¨ì„± ì ìˆ˜ë¥¼ ê°€ì§„ í‚¤ì›Œë“œ
                    return data.count >= 2 || data.relevanceScore >= 3;
                })
                .sort((a, b) => {
                    // ê´€ë ¨ì„± ì ìˆ˜ì™€ ë¹ˆë„ë¥¼ ëª¨ë‘ ê³ ë ¤í•œ ì •ë ¬
                    const scoreA = a[1].relevanceScore + (a[1].count * 0.5);
                    const scoreB = b[1].relevanceScore + (b[1].count * 0.5);
                    return scoreB - scoreA;
                })
                .slice(0, 8) // ìµœëŒ€ 8ê°œ ê·¸ë£¹ìœ¼ë¡œ í™•ì¥
                .forEach(([word, data]) => {
                    const groupNews = Array.from(data.newsIndices)
                        .map(index => newsData[index])
                        .filter(news => news); // ìœ íš¨í•œ ë‰´ìŠ¤ë§Œ
                    
                    if (groupNews.length > 0) {
                        groups.push({
                            keyword: word,
                            count: data.count,
                            relevanceScore: data.relevanceScore,
                            news: groupNews
                        });
                        
                        // ì‚¬ìš©ëœ ë‰´ìŠ¤ ì¸ë±ìŠ¤ ê¸°ë¡
                        data.newsIndices.forEach(idx => usedNewsIndices.add(idx));
                    }
                });

            // ê·¸ë£¹ì— ì†í•˜ì§€ ì•Šì€ ë‰´ìŠ¤ë“¤ì„ ìœ„í•œ ì¶”ê°€ ì²˜ë¦¬
            const ungroupedNews = newsData.filter((news, index) => !usedNewsIndices.has(index));
            
            // ë¯¸ë¶„ë¥˜ ë‰´ìŠ¤ê°€ ë§ìœ¼ë©´ ì¶”ê°€ í‚¤ì›Œë“œ ê·¸ë£¹ ìƒì„±
            if (ungroupedNews.length > 0) {
                // ë¯¸ë¶„ë¥˜ ë‰´ìŠ¤ì—ì„œ ê³µí†µ í‚¤ì›Œë“œ ì¬ì¶”ì¶œ
                const additionalKeywords = extractAdditionalKeywords(ungroupedNews, centerKeyword);
                
                additionalKeywords.forEach(keywordGroup => {
                    if (keywordGroup.news.length > 0) {
                        groups.push(keywordGroup);
                        keywordGroup.news.forEach(news => {
                            const index = newsData.findIndex(n => n.fullTitle === news.fullTitle);
                            if (index !== -1) usedNewsIndices.add(index);
                        });
                    }
                });
            }

            return groups;
        }

        // ë¯¸ë¶„ë¥˜ ë‰´ìŠ¤ë¥¼ ìœ„í•œ ì¶”ê°€ í‚¤ì›Œë“œ ì¶”ì¶œ
        function extractAdditionalKeywords(ungroupedNews, centerKeyword) {
            const additionalGroups = [];
            
            // ë„ë©”ì¸ë³„ ê·¸ë£¹í•‘
            const domainGroups = new Map();
            ungroupedNews.forEach(news => {
                const domain = news.domain || 'ê¸°íƒ€';
                if (!domainGroups.has(domain)) {
                    domainGroups.set(domain, []);
                }
                domainGroups.get(domain).push(news);
            });
            
            // ë„ë©”ì¸ë³„ë¡œ 2ê°œ ì´ìƒ ë‰´ìŠ¤ê°€ ìˆìœ¼ë©´ ê·¸ë£¹ ìƒì„±
            domainGroups.forEach((newsArray, domain) => {
                if (newsArray.length >= 2) {
                    additionalGroups.push({
                        keyword: `${domain} ë‰´ìŠ¤`,
                        count: newsArray.length,
                        relevanceScore: newsArray.length,
                        news: newsArray,
                        type: 'domain-group'
                    });
                }
            });
            
            // ì‹œê°„ëŒ€ë³„ ê·¸ë£¹í•‘ (ìµœì‹  ë‰´ìŠ¤)
            const recentNews = ungroupedNews.filter(news => news.isRecent);
            if (recentNews.length >= 2) {
                additionalGroups.push({
                    keyword: 'ìµœì‹  ì†ë³´',
                    count: recentNews.length,
                    relevanceScore: recentNews.length * 2, // ìµœì‹  ë‰´ìŠ¤ì— ê°€ì¤‘ì¹˜
                    news: recentNews,
                    type: 'time-group'
                });
            }
            
            return additionalGroups;
        }

        // í‚¤ì›Œë“œ íˆ´íŒ í•¨ìˆ˜
        function showKeywordTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            
            // ê·¸ë£¹ íƒ€ì…ë³„ ì•„ì´ì½˜ê³¼ ì„¤ëª…
            const groupTypeInfo = {
                'domain-group': { icon: 'ğŸŒ', name: 'ë„ë©”ì¸ë³„ ê·¸ë£¹', desc: 'ê°™ì€ ì–¸ë¡ ì‚¬ì˜ ë‰´ìŠ¤ë“¤' },
                'time-group': { icon: 'â°', name: 'ì‹œê°„ë³„ ê·¸ë£¹', desc: 'ë¹„ìŠ·í•œ ì‹œê°„ëŒ€ì˜ ë‰´ìŠ¤ë“¤' },
                'credibility-group': { icon: 'ğŸ›¡ï¸', name: 'ì‹ ë¢°ë„ë³„ ê·¸ë£¹', desc: 'ì‹ ë¢°ë„ê°€ ìœ ì‚¬í•œ ë‰´ìŠ¤ë“¤' },
                'misc-group': { icon: 'ğŸ“‚', name: 'ê¸°íƒ€ ê·¸ë£¹', desc: 'ë¶„ë¥˜ë˜ì§€ ì•Šì€ ê´€ë ¨ ë‰´ìŠ¤ë“¤' },
                'keyword-group': { icon: 'ğŸ”‘', name: 'í‚¤ì›Œë“œ ê·¸ë£¹', desc: 'ê³µí†µ í‚¤ì›Œë“œë¥¼ ê°€ì§„ ë‰´ìŠ¤ë“¤' }
            };
            
            const groupInfo = groupTypeInfo[d.groupType] || groupTypeInfo['keyword-group'];
            
            tooltip.innerHTML = `
                <div style="border-left: 4px solid ${getGroupColor(d.groupType)}; padding-left: 8px;">
                    <strong style="color: ${getGroupColor(d.groupType)};">${groupInfo.icon} ${groupInfo.name}: "${d.name}"</strong><br>
                    <div style="margin: 8px 0; padding: 4px 0; border-top: 1px solid rgba(255,255,255,0.2);">
                        <strong>ğŸ“Š ê´€ë ¨ ë‰´ìŠ¤:</strong> ${d.newsCount}ê°œ<br>
                        <strong>ğŸ¯ ë¶„ë¥˜ ê¸°ì¤€:</strong> ${groupInfo.desc}<br>
                        ${d.relevanceScore ? `<strong>â­ ê´€ë ¨ì„± ì ìˆ˜:</strong> ${d.relevanceScore}<br>` : ''}
                    </div>
                    <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">
                        ğŸ’¡ ì´ ê·¸ë£¹ì˜ ë‰´ìŠ¤ë“¤ì„ í´ë¦­í•˜ë©´ ì›ë¬¸ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </div>
                </div>
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }
        
        // ê·¸ë£¹ íƒ€ì…ë³„ ìƒ‰ìƒ ë°˜í™˜
        function getGroupColor(groupType) {
            switch(groupType) {
                case 'domain-group': return '#ff9500';
                case 'time-group': return '#00d4ff';
                case 'credibility-group': return '#a855f7';
                case 'misc-group': return '#6b7280';
                default: return '#8338ec';
            }
        }
        function createKeywordClusters(newsData, originalKeyword) {
            const clusters = new Map();
            
            // ì›ë³¸ í‚¤ì›Œë“œ í´ëŸ¬ìŠ¤í„°
            clusters.set('main', {
                id: 'main',
                label: originalKeyword,
                type: 'main-keyword',
                news: []
            });
            
            // ë‰´ìŠ¤ì—ì„œ ê³µí†µ í‚¤ì›Œë“œ ì¶”ì¶œ
            const keywordFreq = new Map();
            
            newsData.forEach((news, index) => {
                const words = news.title.toLowerCase()
                    .replace(/[^\w\sê°€-í£]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 2 && !['ë‰´ìŠ¤', 'ê¸°ì‚¬', 'ë³´ë„'].includes(word));
                
                words.forEach(word => {
                    if (!keywordFreq.has(word)) {
                        keywordFreq.set(word, { count: 0, newsIndices: [] });
                    }
                    keywordFreq.get(word).count++;
                    keywordFreq.get(word).newsIndices.push(index);
                });
            });
            
            // ë¹ˆë„ê°€ ë†’ì€ í‚¤ì›Œë“œë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„± (2ê°œ ì´ìƒ ë‰´ìŠ¤ì—ì„œ ì–¸ê¸‰)
            Array.from(keywordFreq.entries())
                .filter(([word, data]) => data.count >= 2 && word !== originalKeyword.toLowerCase())
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 4) // ìµœëŒ€ 4ê°œ ì¶”ê°€ í´ëŸ¬ìŠ¤í„°
                .forEach(([word, data]) => {
                    clusters.set(word, {
                        id: `cluster-${word}`,
                        label: word,
                        type: 'keyword-cluster',
                        news: data.newsIndices,
                        frequency: data.count
                    });
                });
            
            return clusters;
        }
        let currentSimulation = null;
        let currentZoom = null;
        let currentNodes = null;

        function fitAllNodes() {
            if (!currentNodes || !currentZoom) return;

            const svg = d3.select('#mindmapSvg');
            const width = svg.node().clientWidth;
            const height = svg.node().clientHeight;

            // ëª¨ë“  ë…¸ë“œì˜ ê²½ê³„ ê³„ì‚°
            const margin = 80;
            let minX = Infinity, maxX = -Infinity;
            let minY = Infinity, maxY = -Infinity;

            currentNodes.forEach(d => {
                if (d.x < minX) minX = d.x;
                if (d.x > maxX) maxX = d.x;
                if (d.y < minY) minY = d.y;
                if (d.y > maxY) maxY = d.y;
            });

            // ë…¸ë“œë“¤ì´ ëª¨ë‘ ë³´ì´ë„ë¡ ìŠ¤ì¼€ì¼ê³¼ ë³€í™˜ ê³„ì‚°
            const nodeWidth = maxX - minX;
            const nodeHeight = maxY - minY;
            
            const scale = Math.min(
                (width - margin * 2) / nodeWidth,
                (height - margin * 2) / nodeHeight,
                2  // ìµœëŒ€ 2ë°°ê¹Œì§€ë§Œ í™•ëŒ€
            );

            const centerX = (minX + maxX) / 2;
            const centerY = (minY + maxY) / 2;
            
            const translateX = width / 2 - centerX * scale;
            const translateY = height / 2 - centerY * scale;

            // ë¶€ë“œëŸ¬ìš´ ì „í™˜ìœ¼ë¡œ ì ìš©
            svg.transition()
                .duration(1000)
                .call(currentZoom.transform, d3.zoomIdentity
                    .translate(translateX, translateY)
                    .scale(scale));
        }

        function resetMindMap() {
            if (currentSimulation) {
                currentSimulation.alpha(1).restart();
            }
        }

        function centerMindMap() {
            if (currentZoom) {
                const svg = d3.select('#mindmapSvg');
                svg.transition()
                    .duration(750)
                    .call(currentZoom.transform, d3.zoomIdentity);
            }
        }

        // ì‹œê°í™” ìƒì„± í•¨ìˆ˜
        function createVisualization(query, newsData) {
            createMindMap(query, newsData);
            createTimeline(newsData);
        }

        // ë°©ì‚¬í˜• ë§ˆì¸ë“œë§µ ìƒì„±
        function createMindMap(centerKeyword, newsData) {
            const svg = d3.select('#mindmapSvg');
            svg.selectAll('*').remove();

            const width = svg.node().clientWidth;
            const height = svg.node().clientHeight;
            const centerX = width / 2;
            const centerY = height / 2;

            // ì‹ ë¢°ë„ë³„ ìƒ‰ìƒ
            const credibilityColors = {
                'High': '#00ff88',
                'Medium': '#ffaa00', 
                'Low': '#ff4444'
            };

            // ì¤‘ì‹¬ ë…¸ë“œ ìƒì„±
            const centerNode = {
                x: centerX,
                y: centerY,
                text: centerKeyword,
                type: 'center',
                radius: 40
            };

            // ë‰´ìŠ¤ ë…¸ë“œë“¤ì„ ë°©ì‚¬í˜•ìœ¼ë¡œ ë°°ì¹˜
            const newsNodes = newsData.map((news, i) => {
                const angle = (i / newsData.length) * 2 * Math.PI;
                const radius = 150 + Math.random() * 100; // ê±°ë¦¬ì— ì•½ê°„ì˜ ë³€í™”
                
                return {
                    x: centerX + Math.cos(angle) * radius,
                    y: centerY + Math.sin(angle) * radius,
                    text: news.title.length > 30 ? news.title.substring(0, 30) + '...' : news.title,
                    fullTitle: news.title,
                    url: news.url,
                    type: 'news',
                    credibility: news.credibility || 'Medium',
                    credibilityColor: credibilityColors[news.credibility || 'Medium'],
                    radius: 25,
                    publishedAt: news.publishedAt
                };
            });

            const allNodes = [centerNode, ...newsNodes];

            // ì¤‘ì‹¬ì—ì„œ ê° ë‰´ìŠ¤ë¡œ ì—°ê²°í•˜ëŠ” ì§ì„  ë§í¬ ê·¸ë¦¬ê¸°
            svg.append('g')
                .selectAll('line')
                .data(newsNodes)
                .enter()
                .append('line')
                .attr('x1', centerNode.x)
                .attr('y1', centerNode.y)
                .attr('x2', d => d.x)
                .attr('y2', d => d.y)
                .attr('stroke', '#00ffff')
                .attr('stroke-width', 2)
                .attr('opacity', 0.6);

            // ë…¸ë“œ ê·¸ë¦¬ê¸°
            const nodeGroup = svg.append('g')
                .selectAll('g')
                .data(allNodes)
                .enter()
                .append('g')
                .attr('transform', d => `translate(${d.x}, ${d.y})`);

            // ì›í˜• ë…¸ë“œ
            nodeGroup.append('circle')
                .attr('r', d => d.radius)
                .attr('fill', d => {
                    if (d.type === 'center') return '#ff006e';
                    return d.credibilityColor;
                })
                .attr('stroke', '#fff')
                .attr('stroke-width', 3)
                .style('filter', d => {
                    if (d.type === 'center') return 'drop-shadow(0 0 20px rgba(255, 0, 110, 0.8))';
                    return `drop-shadow(0 0 10px ${d.credibilityColor}60)`;
                })
                .on('click', function(event, d) {
                    if (d.type === 'news' && d.url) {
                        window.open(d.url, '_blank');
                    }
                })
                .on('mouseover', function(event, d) {
                    if (d.type === 'news') {
                        // íˆ´íŒ í‘œì‹œ
                        d3.select('body').append('div')
                            .attr('class', 'tooltip')
                            .style('position', 'absolute')
                            .style('background', 'rgba(0, 0, 0, 0.8)')
                            .style('color', 'white')
                            .style('padding', '10px')
                            .style('border-radius', '5px')
                            .style('pointer-events', 'none')
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 10) + 'px')
                            .html(`<strong>${d.fullTitle}</strong><br>ì‹ ë¢°ë„: ${d.credibility}`);
                    }
                })
                .on('mouseout', function() {
                    d3.selectAll('.tooltip').remove();
                });

            // í…ìŠ¤íŠ¸ ë ˆì´ë¸”
            nodeGroup.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '0.35em')
                .attr('fill', 'white')
                .attr('font-size', d => d.type === 'center' ? '16px' : '12px')
                .attr('font-weight', d => d.type === 'center' ? 'bold' : 'normal')
                .text(d => d.text)
                .style('pointer-events', 'none');
        }

            // ë…¸ë“œ ìœ„ì¹˜ ì¡°ì •
            nodes.forEach(d => {
                d.x = d.x + centerX - (width - margin * 2) / 2;
                d.y = d.y + centerY - (height - margin * 2) / 2;
            });

            // ë§í¬ ê·¸ë¦¬ê¸° (ê³¡ì„ ìœ¼ë¡œ)
            const link = svg.append('g')
                .selectAll('path')
                .data(links)
                .enter()
                .append('path')
                .attr('d', d => {
                    return `M${d.source.x},${d.source.y}
                            C${d.source.x},${(d.source.y + d.target.y) / 2}
                             ${d.target.x},${(d.source.y + d.target.y) / 2}
                             ${d.target.x},${d.target.y}`;
                })
                .style('fill', 'none')
                .style('stroke', d => {
                    if (d.source.depth === 0) return 'rgba(255, 0, 110, 0.6)'; // ë£¨íŠ¸ì—ì„œ
                    if (d.target.data.type === 'news') return 'rgba(0, 255, 255, 0.4)'; // ë‰´ìŠ¤ë¡œ
                    return 'rgba(131, 56, 236, 0.5)'; // í‚¤ì›Œë“œ ê°„
                })
                .style('stroke-width', d => {
                    if (d.source.depth === 0) return 4;
                    if (d.target.data.type === 'news') return 2;
                    return 3;
                })
                .style('opacity', 0.8);

            // ë…¸ë“œ ê·¸ë£¹ ìƒì„±
            const node = svg.append('g')
                .selectAll('g')
                .data(nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x}, ${d.y})`)
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            // ë…¸ë“œ ì› ê·¸ë¦¬ê¸°
            node.append('circle')
                .attr('r', d => {
                    if (d.depth === 0) return 50; // ë£¨íŠ¸ í‚¤ì›Œë“œ
                    if (d.data.type === 'keyword') return 35; // ì„œë¸Œ í‚¤ì›Œë“œ
                    if (d.data.type === 'news') return d.data.isRecent ? 28 : 22; // ë‰´ìŠ¤
                    return 25;
                })
                .style('fill', d => {
                    if (d.depth === 0) return '#ff006e'; // ë£¨íŠ¸
                    if (d.data.type === 'keyword') {
                        // ê·¸ë£¹ íƒ€ì…ë³„ ìƒ‰ìƒ
                        switch(d.data.groupType) {
                            case 'domain-group': return '#ff9500'; // ë„ë©”ì¸ ê·¸ë£¹
                            case 'time-group': return '#00d4ff'; // ì‹œê°„ ê·¸ë£¹
                            case 'credibility-group': return '#a855f7'; // ì‹ ë¢°ë„ ê·¸ë£¹
                            case 'misc-group': return '#6b7280'; // ê¸°íƒ€ ê·¸ë£¹
                            default: return '#8338ec'; // ì¼ë°˜ í‚¤ì›Œë“œ ê·¸ë£¹
                        }
                    }
                    if (d.data.type === 'news') return d.data.credibilityColor; // ë‰´ìŠ¤
                    return '#00ffff';
                })
                .style('stroke', '#fff')
                .style('stroke-width', d => {
                    if (d.depth === 0) return 4;
                    if (d.data.type === 'keyword') return 3;
                    return d.data.isRecent ? 3 : 2;
                })
                .style('filter', function(d) {
                    if (d.depth === 0) return 'drop-shadow(0 0 20px rgba(255, 0, 110, 0.8))';
                    if (d.data.type === 'keyword') {
                        const color = d3.select(this).style('fill');
                        return `drop-shadow(0 0 15px ${color}60)`;
                    }
                    if (d.data.isRecent) return 'drop-shadow(0 0 10px rgba(255, 255, 0, 0.5))';
                    return `drop-shadow(0 0 8px ${d.data.credibilityColor || '#00ffff'}40)`;
                })
                .on('click', function(event, d) {
                    if (d.data.type === 'news' && d.data.url) {
                        window.open(d.data.url, '_blank');
                    }
                })
                .on('mouseover', function(event, d) {
                    if (d.data.type === 'news') {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('r', d.data.isRecent ? 33 : 27)
                            .style('stroke-width', 4);
                        showEnhancedTooltip(event, d.data);
                    } else if (d.data.type === 'keyword') {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('r', 40)
                            .style('stroke-width', 4);
                        showKeywordTooltip(event, d.data);
                    }
                })
                .on('mouseout', function(event, d) {
                    if (d.data.type === 'news') {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('r', d.data.isRecent ? 28 : 22)
                            .style('stroke-width', d.data.isRecent ? 3 : 2);
                    } else if (d.data.type === 'keyword') {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('r', 35)
                            .style('stroke-width', 3);
                    }
                    hideTooltip();
                });

            // í…ìŠ¤íŠ¸ ë ˆì´ë¸”
            node.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '0.35em')
                .style('font-size', d => {
                    if (d.depth === 0) return '16px';
                    if (d.data.type === 'keyword') return '12px';
                    return '10px';
                })
                .style('font-weight', 'bold')
                .style('fill', 'white')
                .style('text-shadow', '1px 1px 2px rgba(0,0,0,0.7)')
                .style('pointer-events', 'none')
                .text(d => {
                    if (d.depth === 0) return d.data.name;
                    if (d.data.type === 'keyword') return d.data.name;
                    if (d.data.type === 'news') return d.data.matchCount || 'â€¢';
                    return d.data.name;
                });

            // ë‰´ìŠ¤ ë…¸ë“œì— ì¶”ê°€ ì •ë³´ í‘œì‹œ
            node.filter(d => d.data.type === 'news')
                .each(function(d) {
                    const nodeGroup = d3.select(this);
                    
                    // ìµœì‹  ë‰´ìŠ¤ ë°°ì§€
                    if (d.data.isRecent) {
                        nodeGroup.append('circle')
                            .attr('r', 8)
                            .attr('cx', 20)
                            .attr('cy', -20)
                            .style('fill', '#ffff00')
                            .style('stroke', '#fff')
                            .style('stroke-width', 1);
                        
                        nodeGroup.append('text')
                            .attr('x', 20)
                            .attr('y', -16)
                            .attr('text-anchor', 'middle')
                            .style('font-size', '8px')
                            .style('font-weight', 'bold')
                            .style('fill', '#000')
                            .text('NEW');
                    }
                    
                    // ì‹ ë¢°ë„ í‘œì‹œ
                    nodeGroup.append('circle')
                        .attr('r', 6)
                        .attr('cx', -20)
                        .attr('cy', -20)
                        .style('fill', d.data.credibilityColor)
                        .style('stroke', '#fff')
                        .style('stroke-width', 1);
                });

            // í‚¤ì›Œë“œ ë…¸ë“œì— ë¹ˆë„ í‘œì‹œ
            node.filter(d => d.data.type === 'keyword')
                .each(function(d) {
                    const nodeGroup = d3.select(this);
                    
                    nodeGroup.append('circle')
                        .attr('r', 10)
                        .attr('cx', 25)
                        .attr('cy', -25)
                        .style('fill', '#fff')
                        .style('stroke', '#8338ec')
                        .style('stroke-width', 2);
                    
                    nodeGroup.append('text')
                        .attr('x', 25)
                        .attr('y', -21)
                        .attr('text-anchor', 'middle')
                        .style('font-size', '10px')
                        .style('font-weight', 'bold')
                        .style('fill', '#8338ec')
                        .text(d.data.newsCount || 0);
                });

            // ë“œë˜ê·¸ í•¨ìˆ˜ë“¤
            function dragstarted(event, d) {
                d3.select(this).raise();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = Math.max(margin, Math.min(width - margin, event.x));
                d.fy = Math.max(margin, Math.min(height - margin, event.y));
                
                // ë…¸ë“œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                d3.select(this).attr('transform', `translate(${d.fx}, ${d.fy})`);
                
                // ì—°ê²°ëœ ë§í¬ ì—…ë°ì´íŠ¸
                link.attr('d', linkData => {
                    const source = linkData.source.fx !== undefined ? 
                        {x: linkData.source.fx, y: linkData.source.fy} : 
                        {x: linkData.source.x, y: linkData.source.y};
                    const target = linkData.target.fx !== undefined ? 
                        {x: linkData.target.fx, y: linkData.target.fy} : 
                        {x: linkData.target.x, y: linkData.target.y};
                    
                    return `M${source.x},${source.y}
                            C${source.x},${(source.y + target.y) / 2}
                             ${target.x},${(source.y + target.y) / 2}
                             ${target.x},${target.y}`;
                });
            }

            function dragended(event, d) {
                d.fx = null;
                d.fy = null;
            }

            // ì¤Œ ê¸°ëŠ¥
            const zoom = d3.zoom()
                .scaleExtent([0.3, 4])
                .on('zoom', function(event) {
                    svg.selectAll('g').attr('transform', event.transform);
                });

            svg.call(zoom);
            currentZoom = zoom;

            // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
            currentNodes = nodes;

            // ì´ˆê¸° ì• ë‹ˆë©”ì´ì…˜
            node.style('opacity', 0)
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100)
                .style('opacity', 1);

            link.style('opacity', 0)
                .transition()
                .duration(1200)
                .delay(800)
                .style('opacity', 0.8);

        // í´ëŸ¬ìŠ¤í„° íˆ´íŒ í•¨ìˆ˜
        function showClusterTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <div style="border-left: 4px solid #8338ec; padding-left: 8px;">
                    <strong style="color: #8338ec;">ğŸ”— í‚¤ì›Œë“œ í´ëŸ¬ìŠ¤í„°: "${d.label}"</strong><br>
                    <div style="margin: 8px 0; padding: 4px 0; border-top: 1px solid rgba(255,255,255,0.2);">
                        <strong>ğŸ“Š ì–¸ê¸‰ ë¹ˆë„:</strong> ${d.frequency}ê°œ ë‰´ìŠ¤<br>
                        <strong>ğŸ¯ ì—°ê²°ëœ ë‰´ìŠ¤:</strong> ${d.news ? d.news.length : 0}ê°œ
                    </div>
                    <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">
                        ì´ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ë‰´ìŠ¤ë“¤ì´ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤
                    </div>
                </div>
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        // ì‹œê°„ëŒ€ë³„ ë‰´ìŠ¤ í‘œ ìƒì„±
        function createTimeline(newsData) {
            const container = d3.select('#timeline');
            container.selectAll('*').remove();

            // ë‰´ìŠ¤ë¥¼ ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
            const newsByDate = {};
            newsData.forEach(news => {
                const date = news.publishedAt ? new Date(news.publishedAt).toLocaleDateString('ko-KR') : 'ë‚ ì§œ ë¯¸ìƒ';
                if (!newsByDate[date]) {
                    newsByDate[date] = [];
                }
                newsByDate[date].push(news);
            });

            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
            const sortedDates = Object.keys(newsByDate).sort((a, b) => {
                if (a === 'ë‚ ì§œ ë¯¸ìƒ') return 1;
                if (b === 'ë‚ ì§œ ë¯¸ìƒ') return -1;
                return new Date(b) - new Date(a);
            });

            // í‘œ ìƒì„±
            const table = container.append('table')
                .style('width', '100%')
                .style('border-collapse', 'collapse')
                .style('background', 'rgba(0, 0, 0, 0.8)')
                .style('border-radius', '10px')
                .style('overflow', 'hidden');

            // í—¤ë”
            const header = table.append('thead').append('tr');
            header.append('th')
                .text('ë‚ ì§œ')
                .style('padding', '15px')
                .style('background', '#ff006e')
                .style('color', 'white')
                .style('font-weight', 'bold')
                .style('text-align', 'left')
                .style('width', '120px');
            
            header.append('th')
                .text('ë‰´ìŠ¤ ì œëª©')
                .style('padding', '15px')
                .style('background', '#ff006e')
                .style('color', 'white')
                .style('font-weight', 'bold')
                .style('text-align', 'left');
            
            header.append('th')
                .text('ì‹ ë¢°ë„')
                .style('padding', '15px')
                .style('background', '#ff006e')
                .style('color', 'white')
                .style('font-weight', 'bold')
                .style('text-align', 'center')
                .style('width', '100px');

            // ë°”ë””
            const tbody = table.append('tbody');

            sortedDates.forEach((date, dateIndex) => {
                const newsForDate = newsByDate[date];
                
                newsForDate.forEach((news, newsIndex) => {
                    const row = tbody.append('tr')
                        .style('border-bottom', '1px solid rgba(255, 255, 255, 0.1)')
                        .style('cursor', news.url ? 'pointer' : 'default')
                        .on('click', function() {
                            if (news.url) {
                                window.open(news.url, '_blank');
                            }
                        })
                        .on('mouseover', function() {
                            d3.select(this).style('background', 'rgba(255, 255, 255, 0.1)');
                        })
                        .on('mouseout', function() {
                            d3.select(this).style('background', 'transparent');
                        });

                    // ë‚ ì§œ ì…€ (ì²« ë²ˆì§¸ ë‰´ìŠ¤ì—ë§Œ í‘œì‹œ)
                    if (newsIndex === 0) {
                        row.append('td')
                            .text(date)
                            .style('padding', '12px 15px')
                            .style('color', '#00ffff')
                            .style('font-weight', 'bold')
                            .style('vertical-align', 'top')
                            .attr('rowspan', newsForDate.length);
                    }

                    // ì œëª© ì…€
                    row.append('td')
                        .text(news.title)
                        .style('padding', '12px 15px')
                        .style('color', 'white')
                        .style('line-height', '1.4');

                    // ì‹ ë¢°ë„ ì…€
                    const credibilityColors = {
                        'High': '#00ff88',
                        'Medium': '#ffaa00',
                        'Low': '#ff4444'
                    };
                    
                    row.append('td')
                        .text(news.credibility || 'Medium')
                        .style('padding', '12px 15px')
                        .style('color', credibilityColors[news.credibility || 'Medium'])
                        .style('font-weight', 'bold')
                        .style('text-align', 'center');
                });
            });
        }
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            // ë‚ ì§œë³„ ë‰´ìŠ¤ ê°œìˆ˜ ì§‘ê³„
            const dateCount = {};
            newsData.forEach(news => {
                const date = news.publishedDate;
                dateCount[date] = (dateCount[date] || 0) + 1;
            });

            const timelineData = Object.entries(dateCount)
                .map(([date, count]) => ({ date: new Date(date), count }))
                .sort((a, b) => a.date - b.date);

            // ìŠ¤ì¼€ì¼ ì„¤ì •
            const xScale = d3.scaleTime()
                .domain(d3.extent(timelineData, d => d.date))
                .range([margin.left, width - margin.right]);

            const yScale = d3.scaleLinear()
                .domain([0, d3.max(timelineData, d => d.count)])
                .range([height - margin.bottom, margin.top]);

            // ë¼ì¸ ìƒì„±ê¸°
            const line = d3.line()
                .x(d => xScale(d.date))
                .y(d => yScale(d.count))
                .curve(d3.curveMonotoneX);

            // ì¶• ê·¸ë¦¬ê¸°
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0, ${height - margin.bottom})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat('%m/%d')));

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(${margin.left}, 0)`)
                .call(d3.axisLeft(yScale));

            // ë¼ì¸ ê·¸ë¦¬ê¸°
            svg.append('path')
                .datum(timelineData)
                .attr('fill', 'none')
                .attr('stroke', '#00ffff')
                .attr('stroke-width', 3)
                .attr('d', line);

            // ì  ê·¸ë¦¬ê¸°
            svg.selectAll('.dot')
                .data(timelineData)
                .enter()
                .append('circle')
                .attr('class', 'dot')
                .attr('cx', d => xScale(d.date))
                .attr('cy', d => yScale(d.count))
                .attr('r', 5)
                .attr('fill', '#ff006e')
                .attr('stroke', 'white')
                .attr('stroke-width', 2);

            // ë ˆì´ë¸”
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 5)
                .attr('text-anchor', 'middle')
                .style('fill', 'white')
                .style('font-size', '12px')
                .text('ë‚ ì§œ');

            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .attr('text-anchor', 'middle')
                .style('fill', 'white')
                .style('font-size', '12px')
                .text('ë‰´ìŠ¤ ê°œìˆ˜');
        }

        // ê³ ë„í™”ëœ íˆ´íŒ í‘œì‹œ
        function showEnhancedTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            
            const credibilityEmoji = {
                'High': 'ğŸŸ¢',
                'Medium': 'ğŸŸ¡', 
                'Low': 'ğŸ”´'
            };

            tooltip.innerHTML = `
                <div style="border-left: 4px solid ${d.credibilityColor}; padding-left: 8px;">
                    <strong style="color: ${d.credibilityColor};">${d.fullTitle}</strong><br>
                    <div style="margin: 8px 0; padding: 4px 0; border-top: 1px solid rgba(255,255,255,0.2);">
                        <strong>ğŸ“° ì¶œì²˜:</strong> ${d.domain}<br>
                        <strong>ğŸ“… ë°œí–‰:</strong> ${d.timeText} (${d.publishedDate})<br>
                        <strong>${credibilityEmoji[d.credibility]} ì‹ ë¢°ë„:</strong> ${d.credibility}<br>
                        <strong>ğŸ¯ ë§¤ì¹­:</strong> ${d.matchCount}ê°œ í‚¤ì›Œë“œ
                        ${d.isRecent ? '<br><strong>âš¡ ìµœì‹  ë‰´ìŠ¤</strong>' : ''}
                    </div>
                    ${d.description ? `<div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">${d.description.substring(0, 100)}...</div>` : ''}
                    <div style="margin-top: 8px; font-size: 10px; opacity: 0.7;">
                        ğŸ’¡ í´ë¦­í•˜ë©´ ì›ë¬¸ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </div>
                </div>
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        // íˆ´íŒ ìˆ¨ê¸°ê¸°
        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ
        function wrapText(text, width) {
            text.each(function() {
                const text = d3.select(this);
                const words = text.text().split(/\s+/).reverse();
                let word;
                let line = [];
                let lineNumber = 0;
                const lineHeight = 1.1;
                const y = text.attr('y') || 0;
                const dy = 0;
                let tspan = text.text(null).append('tspan').attr('x', 0).attr('y', y).attr('dy', dy + 'em');

                while (word = words.pop()) {
                    line.push(word);
                    tspan.text(line.join(' '));
                    if (tspan.node().getComputedTextLength() > width) {
                        line.pop();
                        tspan.text(line.join(' '));
                        line = [word];
                        tspan = text.append('tspan').attr('x', 0).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                    }
                }
            });
        }

        console.log('âœ… JavaScript ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
